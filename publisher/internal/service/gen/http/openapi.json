{"swagger":"2.0","info":{"title":"Publish API","description":"Publish API","contact":{"name":"WuHui Zuo","email":"wuhui.zuo@pingcap.com","url":"https://github.com/wuhuizuo"},"version":"1.0.0"},"host":"0.0.0.0:80","consumes":["application/json","application/xml","application/gob"],"produces":["application/json","application/xml","application/gob"],"paths":{"/fs/publish-request":{"post":{"tags":["fileserver"],"summary":"request-to-publish fileserver","operationId":"fileserver#request-to-publish","parameters":[{"name":"Request-To-PublishRequestBody","in":"body","required":true,"schema":{"$ref":"#/definitions/FileserverRequestToPublishRequestBody","required":["artifact_url"]}}],"responses":{"200":{"description":"OK response.","schema":{"type":"array","items":{"type":"string","description":"Request id for async mode (uuidv4 format)","example":"f86cc458-00e4-4ae6-b308-fe1d2f3ffbc2","format":"uuid"}}}},"schemes":["http"]}},"/fs/publish-request/{request_id}":{"get":{"tags":["fileserver"],"summary":"query-publishing-status fileserver","operationId":"fileserver#query-publishing-status","parameters":[{"name":"request_id","in":"path","description":"Request id for async mode (uuidv4 format)","required":true,"type":"string","format":"uuid"}],"responses":{"200":{"description":"OK response.","schema":{"type":"string","enum":["queued","processing","success","failed","canceled"]}}},"schemes":["http"]}},"/image/collect-multiarch":{"post":{"tags":["image"],"summary":"request-multiarch-collect image","operationId":"image#request-multiarch-collect","parameters":[{"name":"Request-Multiarch-CollectRequestBody","in":"body","required":true,"schema":{"$ref":"#/definitions/ImageRequestMultiarchCollectRequestBody","required":["image_url"]}}],"responses":{"200":{"description":"OK response.","schema":{"$ref":"#/definitions/ImageRequestMultiarchCollectResponseBody","required":["async"]}}},"schemes":["http"]}},"/image/collect-multiarch/{request_id}":{"get":{"tags":["image"],"summary":"query-multiarch-collect-status image","operationId":"image#query-multiarch-collect-status","parameters":[{"name":"request_id","in":"path","description":"Request id for async mode (uuidv4 format)","required":true,"type":"string","format":"uuid"}],"responses":{"200":{"description":"OK response.","schema":{"type":"string","enum":["queued","processing","success","failed","canceled"]}}},"schemes":["http"]}},"/image/copy":{"post":{"tags":["image"],"summary":"request-to-copy image","operationId":"image#request-to-copy","parameters":[{"name":"Request-To-CopyRequestBody","in":"body","required":true,"schema":{"$ref":"#/definitions/ImageRequestToCopyRequestBody","required":["source","destination"]}}],"responses":{"200":{"description":"OK response.","schema":{"type":"string","format":"uuid"}}},"schemes":["http"]}},"/image/copy/{request_id}":{"get":{"tags":["image"],"summary":"query-copying-status image","operationId":"image#query-copying-status","parameters":[{"name":"request_id","in":"path","description":"Request id for async mode (uuidv4 format)","required":true,"type":"string","format":"uuid"}],"responses":{"200":{"description":"OK response.","schema":{"type":"string","enum":["queued","processing","success","failed","canceled"]}}},"schemes":["http"]}},"/tidbcloud/devops/cloudconfig/versions/component":{"post":{"tags":["tidbcloud"],"summary":"update-component-version-in-cloudconfig tidbcloud","operationId":"tidbcloud#update-component-version-in-cloudconfig","parameters":[{"name":"Update-Component-Version-In-CloudconfigRequestBody","in":"body","required":true,"schema":{"$ref":"#/definitions/TidbcloudUpdateComponentVersionInCloudconfigRequestBody","required":["stage","image"]}}],"responses":{"200":{"description":"OK response.","schema":{"$ref":"#/definitions/TidbcloudUpdateComponentVersionInCloudconfigResponseBody","required":["stage","ticket"]}}},"schemes":["http"]}},"/tiup/delivery-by-rules":{"post":{"tags":["tiup"],"summary":"delivery-by-rules tiup","description":"Request to delivery TiUP packages from OCI artifact controlled by delivery rules","operationId":"tiup#delivery-by-rules","parameters":[{"name":"Delivery-By-RulesRequestBody","in":"body","required":true,"schema":{"$ref":"#/definitions/TiupDeliveryByRulesRequestBody","required":["artifact_url"]}}],"responses":{"200":{"description":"OK response.","schema":{"type":"array","items":{"type":"string","example":"Est saepe reprehenderit at iste optio animi."}}}},"schemes":["http"]}},"/tiup/publish-request":{"post":{"tags":["tiup"],"summary":"request-to-publish tiup","description":"Request to publish TiUP packages from a OCI artifact","operationId":"tiup#request-to-publish","parameters":[{"name":"Request-To-PublishRequestBody","in":"body","required":true,"schema":{"$ref":"#/definitions/TiupRequestToPublishRequestBody","required":["artifact_url","tiup_mirror"]}}],"responses":{"200":{"description":"OK response.","schema":{"type":"array","items":{"type":"string","example":"Vel ex voluptatibus."}}}},"schemes":["http"]}},"/tiup/publish-request-single":{"post":{"tags":["tiup"],"summary":"request-to-publish-single tiup","description":"Request to publish a single TiUP package from a binary tarball","operationId":"tiup#request-to-publish-single","parameters":[{"name":"Request-To-Publish-SingleRequestBody","in":"body","required":true,"schema":{"$ref":"#/definitions/PublishRequestTiUP","required":["from","publish"]}}],"responses":{"200":{"description":"OK response.","schema":{"type":"string","format":"uuid"}}},"schemes":["http"]}},"/tiup/publish-request/{request_id}":{"get":{"tags":["tiup"],"summary":"query-publishing-status tiup","operationId":"tiup#query-publishing-status","parameters":[{"name":"request_id","in":"path","description":"request track id","required":true,"type":"string"}],"responses":{"200":{"description":"OK response.","schema":{"type":"string","enum":["queued","processing","success","failed","canceled"]}}},"schemes":["http"]}},"/tiup/reset-rate-limit":{"post":{"tags":["tiup"],"summary":"reset-rate-limit tiup","operationId":"tiup#reset-rate-limit","responses":{"200":{"description":"OK response."}},"schemes":["http"]}}},"definitions":{"FileserverRequestToPublishRequestBody":{"title":"FileserverRequestToPublishRequestBody","type":"object","properties":{"artifact_url":{"type":"string","description":"The full url of the pushed OCI artifact, contain the tag part. It will parse the repo from it.","example":"Aut repudiandae et eius explicabo quo aliquam."}},"example":{"artifact_url":"Aliquid doloribus qui tempore ut."},"required":["artifact_url"]},"From":{"title":"From","type":"object","properties":{"http":{"$ref":"#/definitions/FromHTTP"},"oci":{"$ref":"#/definitions/FromOci"},"type":{"type":"string","example":"oci","enum":["oci","http"]}},"example":{"http":{"url":"https://example.com/tidb-v7.5.0-linux-amd64.tar.gz"},"type":"http"},"required":["type"]},"FromHTTP":{"title":"FromHTTP","type":"object","properties":{"url":{"type":"string","example":"https://example.com/tidb-v7.5.0-linux-amd64.tar.gz"}},"description":"Source from a direct HTTP URL","example":{"url":"https://example.com/tidb-v7.5.0-linux-amd64.tar.gz"},"required":["url"]},"FromOci":{"title":"FromOci","type":"object","properties":{"file":{"type":"string","example":"tidb-v7.5.0-linux-amd64.tar.gz"},"repo":{"type":"string","example":"hub.pingcap.net/dev/ci/tidb"},"tag":{"type":"string","example":"v7.5.0_linux_amd64"}},"description":"Source from an OCI artifact","example":{"file":"tidb-v7.5.0-linux-amd64.tar.gz","repo":"hub.pingcap.net/dev/ci/tidb","tag":"v7.5.0_linux_amd64"},"required":["repo","tag","file"]},"ImageRequestMultiarchCollectRequestBody":{"title":"ImageRequestMultiarchCollectRequestBody","type":"object","properties":{"async":{"type":"boolean","description":"Whether to run the collection asynchronously. If true, returns a request id. If false or omitted, runs synchronously and returns the result directly.","default":false,"example":false},"image_url":{"type":"string","description":"The image URL to collect","example":"Qui dicta et nihil."},"release_tag_suffix":{"type":"string","description":"Suffix for the release tag","default":"release","example":"Reprehenderit architecto eum dolor tempore."}},"example":{"async":false,"image_url":"Ea quia laboriosam facilis ut.","release_tag_suffix":"Blanditiis laboriosam ex corporis est enim."},"required":["image_url"]},"ImageRequestMultiarchCollectResponseBody":{"title":"ImageRequestMultiarchCollectResponseBody","type":"object","properties":{"async":{"type":"boolean","description":"Whether to run the collection asynchronously. If true, returns a request id. If false or omitted, runs synchronously and returns the result directly.","default":false,"example":false},"repo":{"type":"string","description":"Repository of the collected image","example":"Animi doloremque."},"request_id":{"type":"string","description":"Request id for async mode (uuidv4 format)","example":"d2833955-d274-437e-a14e-59a8a014f720","format":"uuid"},"tags":{"type":"array","items":{"type":"string","example":"Corrupti tempore quibusdam reprehenderit porro eaque."},"description":"Tags of the collected image","example":["Rerum aut sequi sequi nihil.","Consequatur eveniet molestias."]}},"example":{"async":false,"repo":"Nulla omnis aperiam consectetur.","request_id":"69f48e81-6383-4b20-9bab-91a9d44b365c","tags":["Ducimus pariatur delectus cupiditate voluptas.","Voluptas fuga nulla molestiae.","Ex dolor."]},"required":["async"]},"ImageRequestToCopyRequestBody":{"title":"ImageRequestToCopyRequestBody","type":"object","properties":{"destination":{"type":"string","description":"destination image url","example":"Ut eaque illum nihil rerum."},"source":{"type":"string","description":"source image url","example":"Similique voluptatem ut veritatis sint vitae."}},"example":{"destination":"Reprehenderit fugiat dolores.","source":"Et necessitatibus eius perspiciatis."},"required":["source","destination"]},"PublishInfoTiUP":{"title":"PublishInfoTiUP","type":"object","properties":{"arch":{"type":"string","example":"amd64"},"description":{"type":"string","example":"TiDB GA"},"entry_point":{"type":"string","example":"bin/tidb-server"},"name":{"type":"string","example":"tidb"},"os":{"type":"string","example":"linux"},"standalone":{"type":"boolean","example":false},"version":{"type":"string","example":"v7.5.0"}},"example":{"arch":"amd64","description":"TiDB GA","entry_point":"bin/tidb-server","name":"tidb","os":"linux","standalone":false,"version":"v7.5.0"},"required":["name","os","arch","version"]},"PublishRequestTiUP":{"title":"PublishRequestTiUP","type":"object","properties":{"from":{"$ref":"#/definitions/From"},"publish":{"$ref":"#/definitions/PublishInfoTiUP"},"tiup_mirror":{"type":"string","description":"`staging` is http://tiup.pingcap.net:8988, `prod` is http://tiup.pingcap.net:8987.","default":"staging","example":"prod","enum":["staging","prod"]}},"example":{"from":{"http":{"url":"https://example.com/tidb-v7.5.0-linux-amd64.tar.gz"},"type":"http"},"publish":{"arch":"amd64","description":"TiDB GA","entry_point":"bin/tidb-server","name":"tidb","os":"linux","standalone":false,"version":"v7.5.0"}},"required":["from","publish"]},"TidbcloudUpdateComponentVersionInCloudconfigRequestBody":{"title":"TidbcloudUpdateComponentVersionInCloudconfigRequestBody","type":"object","properties":{"image":{"type":"string","description":"container image with tag","example":"xxx.com/coomponent:v8.5.4"},"stage":{"type":"string","description":"env stage","example":"prod"}},"example":{"image":"xxx.com/coomponent:v8.5.4","stage":"prod"},"required":["stage","image"]},"TidbcloudUpdateComponentVersionInCloudconfigResponseBody":{"title":"TidbcloudUpdateComponentVersionInCloudconfigResponseBody","type":"object","properties":{"stage":{"type":"string","example":"Et aut voluptates autem aut."},"ticket":{"type":"object","properties":{"change_id":{"type":"string","description":"component publish flow ID","example":"Doloremque tempora impedit quia odio voluptatem voluptatem."},"id":{"type":"string","description":"ticket ID","example":"Et aut nisi debitis ab."},"release_id":{"type":"string","description":"release window ID","example":"Labore voluptates voluptatem eaque quos."},"url":{"type":"string","description":"ticket visit url","example":"http://bosco.net/rupert.kuphal","format":"uri"}},"description":"ticket details","example":{"change_id":"Dolore autem repudiandae.","id":"Cupiditate distinctio.","release_id":"Omnis dolorem soluta vero rerum est dolor.","url":"http://blanda.info/eldora"},"required":["id"]}},"example":{"stage":"Voluptates facilis impedit amet.","ticket":{"change_id":"Qui temporibus voluptatem ut.","id":"Culpa blanditiis assumenda magni vel amet.","release_id":"Rem assumenda.","url":"http://daniel.name/eula"}},"required":["stage","ticket"]},"TiupDeliveryByRulesRequestBody":{"title":"TiupDeliveryByRulesRequestBody","type":"object","properties":{"artifact_url":{"type":"string","description":"The full url of the pushed OCI artifact, contain the tag part. It will parse the repo from it.","example":"oci.com/repo:tag"}},"example":{"artifact_url":"oci.com/repo:tag"},"required":["artifact_url"]},"TiupRequestToPublishRequestBody":{"title":"TiupRequestToPublishRequestBody","type":"object","properties":{"artifact_url":{"type":"string","description":"The full url of the pushed OCI artifact, contain the tag part. It will parse the repo from it.","example":"oci.com/repo:tag"},"tiup_mirror":{"type":"string","description":"`staging` is http://tiup.pingcap.net:8988, `prod` is http://tiup.pingcap.net:8987.","default":"staging","example":"staging","enum":["staging","prod"]},"version":{"type":"string","description":"Force set the version. Default is the artifact version read from `org.opencontainers.image.version` of the manifest config.","example":"v1.0.0"}},"example":{"artifact_url":"oci.com/repo:tag","tiup_mirror":"staging","version":"v1.0.0"},"required":["artifact_url","tiup_mirror"]}}}