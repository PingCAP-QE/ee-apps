{"openapi":"3.0.3","info":{"title":"Publish API","description":"Publish API","contact":{"name":"WuHui Zuo","url":"https://github.com/wuhuizuo","email":"wuhui.zuo@pingcap.com"},"version":"1.0.0"},"servers":[{"url":"http://0.0.0.0:80"}],"paths":{"/fs/publish-request":{"post":{"tags":["fileserver"],"summary":"request-to-publish fileserver","operationId":"fileserver#request-to-publish","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/DeliveryByRulesRequestBody"},"example":{"artifact_url":"Nisi exercitationem laboriosam non."}}}},"responses":{"200":{"description":"OK response.","content":{"application/json":{"schema":{"type":"array","items":{"type":"string","description":"Request id for async mode (uuidv4 format)","example":"a3eef83f-c6c3-4335-bd5c-bb95017fe8dd","format":"uuid"},"description":"request track ids","example":["a2b01793-0dad-43e2-9774-a97a297f98c0","6dda6725-98e8-4a71-9ccd-04b740ad521f"]},"example":["00dece86-ac4c-4c9e-9403-b15d2054c8b1","20b540cc-1909-4e3c-abbd-69575e6b4564","36821999-d155-4885-87b3-ed2f882e72d4"]}}}}}},"/fs/publish-request/{request_id}":{"get":{"tags":["fileserver"],"summary":"query-publishing-status fileserver","operationId":"fileserver#query-publishing-status","parameters":[{"name":"request_id","in":"path","description":"Request id for async mode (uuidv4 format)","required":true,"schema":{"type":"string","description":"Request id for async mode (uuidv4 format)","example":"cfca8501-76b9-415c-9700-e0a2955efe61","format":"uuid"},"example":"642107ab-bf39-441a-ba74-6daaf5d5a85a"}],"responses":{"200":{"description":"OK response.","content":{"application/json":{"schema":{"type":"string","description":"State of the task","example":"failed","enum":["queued","processing","success","failed","canceled"]},"example":"failed"}}}}}},"/image/collect-multiarch":{"post":{"tags":["image"],"summary":"request-multiarch-collect image","operationId":"image#request-multiarch-collect","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RequestMultiarchCollectRequestBody"},"example":{"async":true,"image_url":"Rerum laudantium beatae.","release_tag_suffix":"Laboriosam aut non aut occaecati iure."}}}},"responses":{"200":{"description":"OK response.","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RequestMultiarchCollectResponseBody"},"example":{"async":true,"repo":"Qui doloribus omnis.","request_id":"9eaecd6e-99cd-4b5e-a2de-4a3448a204f0","tags":["At delectus.","Officiis molestiae amet nobis."]}}}}}}},"/image/collect-multiarch/{request_id}":{"get":{"tags":["image"],"summary":"query-multiarch-collect-status image","operationId":"image#query-multiarch-collect-status","parameters":[{"name":"request_id","in":"path","description":"Request id for async mode (uuidv4 format)","required":true,"schema":{"type":"string","description":"Request id for async mode (uuidv4 format)","example":"181d081f-3046-4be8-a0b9-d011c9e1a8e1","format":"uuid"},"example":"c20a6477-6017-4ec6-a3a2-0805fb735a36"}],"responses":{"200":{"description":"OK response.","content":{"application/json":{"schema":{"type":"string","description":"State of the task","example":"processing","enum":["queued","processing","success","failed","canceled"]},"example":"success"}}}}}},"/image/copy":{"post":{"tags":["image"],"summary":"request-to-copy image","operationId":"image#request-to-copy","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RequestToCopyRequestBody"},"example":{"destination":"Dolorum quo ut et.","source":"Aut voluptates sit magni."}}}},"responses":{"200":{"description":"OK response.","content":{"application/json":{"schema":{"type":"string","description":"Request id for async mode (uuidv4 format)","example":"38452c7f-5ea0-497b-b746-9ca3ef3abe16","format":"uuid"},"example":"6946d3fc-da4f-4f10-8f5e-b4d322210552"}}}}}},"/image/copy/{request_id}":{"get":{"tags":["image"],"summary":"query-copying-status image","operationId":"image#query-copying-status","parameters":[{"name":"request_id","in":"path","description":"Request id for async mode (uuidv4 format)","required":true,"schema":{"type":"string","description":"Request id for async mode (uuidv4 format)","example":"2d884f6f-3c6c-4c8a-a36e-c7adcbdb9ada","format":"uuid"},"example":"b477d62a-bd80-4b3e-ad6c-06f80dfba11e"}],"responses":{"200":{"description":"OK response.","content":{"application/json":{"schema":{"type":"string","description":"State of the task","example":"processing","enum":["queued","processing","success","failed","canceled"]},"example":"canceled"}}}}}},"/tidbcloud/devops/cloudconfig/versions/component":{"post":{"tags":["tidbcloud"],"summary":"update-component-version-in-cloudconfig tidbcloud","operationId":"tidbcloud#update-component-version-in-cloudconfig","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UpdateComponentVersionInCloudconfigRequestBody"},"example":{"image":"xxx.com/coomponent:v8.5.4","stage":"prod"}}}},"responses":{"200":{"description":"OK response.","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UpdateComponentVersionInCloudconfigResponseBody"},"example":{"stage":"Veniam nisi.","ticket":{"change_id":"In possimus adipisci.","id":"Excepturi omnis autem sequi saepe fuga.","release_id":"Culpa repellat et ut.","url":"http://medhurst.name/lela.waelchi"}}}}}}}},"/tiup/delivery-by-rules":{"post":{"tags":["tiup"],"summary":"delivery-by-rules tiup","description":"Request to delivery TiUP packages from OCI artifact controlled by delivery rules","operationId":"tiup#delivery-by-rules","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/DeliveryByRulesRequestBody"},"example":{"artifact_url":"oci.com/repo:tag"}}}},"responses":{"200":{"description":"OK response.","content":{"application/json":{"schema":{"type":"array","items":{"type":"string","example":"Voluptatem pariatur voluptatem."},"description":"request track ids","example":["Eius rerum modi officia labore nulla.","Unde et ut et earum.","Unde ducimus minus facilis nihil."]},"example":["Dolorum ex nesciunt et quia facere.","Voluptatibus sed.","Itaque non sed."]}}}}}},"/tiup/publish-request":{"post":{"tags":["tiup"],"summary":"request-to-publish tiup","description":"Request to publish TiUP packages from a OCI artifact","operationId":"tiup#request-to-publish","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RequestToPublishRequestBody"},"example":{"artifact_url":"oci.com/repo:tag","tiup_mirror":"staging","version":"v1.0.0"}}}},"responses":{"200":{"description":"OK response.","content":{"application/json":{"schema":{"type":"array","items":{"type":"string","example":"Vero voluptatum magnam."},"description":"request track ids","example":["Architecto ut suscipit et rerum iusto facilis.","Quas officia distinctio adipisci ut voluptatum sint."]},"example":["Corrupti ea rem.","Placeat nihil saepe velit odit maxime.","Adipisci dolor."]}}}}}},"/tiup/publish-request-single":{"post":{"tags":["tiup"],"summary":"request-to-publish-single tiup","description":"Request to publish a single TiUP package from a binary tarball","operationId":"tiup#request-to-publish-single","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PublishRequestTiUP"},"example":{"from":{"http":{"url":"https://example.com/tidb-v7.5.0-linux-amd64.tar.gz"},"type":"http"},"publish":{"arch":"amd64","description":"TiDB GA","entry_point":"bin/tidb-server","name":"tidb","os":"linux","standalone":false,"version":"v7.5.0"}}}}},"responses":{"200":{"description":"OK response.","content":{"application/json":{"schema":{"type":"string","description":"Request id for async mode (uuidv4 format)","example":"79b13134-6d56-484c-9981-81a0283ee0f1","format":"uuid"},"example":"ef0cdca6-a059-4371-a183-a20bf0883102"}}}}}},"/tiup/publish-request/{request_id}":{"get":{"tags":["tiup"],"summary":"query-publishing-status tiup","operationId":"tiup#query-publishing-status","parameters":[{"name":"request_id","in":"path","description":"request track id","required":true,"schema":{"type":"string","description":"request track id","example":"Perspiciatis eveniet eum quisquam temporibus magnam nemo."},"example":"Aut dolorem debitis non error modi."}],"responses":{"200":{"description":"OK response.","content":{"application/json":{"schema":{"type":"string","description":"State of the task","example":"queued","enum":["queued","processing","success","failed","canceled"]},"example":"canceled"}}}}}},"/tiup/reset-rate-limit":{"post":{"tags":["tiup"],"summary":"reset-rate-limit tiup","operationId":"tiup#reset-rate-limit","responses":{"200":{"description":"OK response."}}}}},"components":{"schemas":{"DeliveryByRulesRequestBody":{"type":"object","properties":{"artifact_url":{"type":"string","description":"The full url of the pushed OCI artifact, contain the tag part. It will parse the repo from it.","example":"oci.com/repo:tag"}},"example":{"artifact_url":"oci.com/repo:tag"},"required":["artifact_url"]},"From":{"type":"object","properties":{"http":{"$ref":"#/components/schemas/FromHTTP"},"oci":{"$ref":"#/components/schemas/FromOci"},"type":{"type":"string","example":"oci","enum":["oci","http"]}},"example":{"http":{"url":"https://example.com/tidb-v7.5.0-linux-amd64.tar.gz"},"type":"http"},"required":["type"]},"FromHTTP":{"type":"object","properties":{"url":{"type":"string","example":"https://example.com/tidb-v7.5.0-linux-amd64.tar.gz"}},"description":"Source from a direct HTTP URL","example":{"url":"https://example.com/tidb-v7.5.0-linux-amd64.tar.gz"},"required":["url"]},"FromOci":{"type":"object","properties":{"file":{"type":"string","example":"tidb-v7.5.0-linux-amd64.tar.gz"},"repo":{"type":"string","example":"hub.pingcap.net/dev/ci/tidb"},"tag":{"type":"string","example":"v7.5.0_linux_amd64"}},"description":"Source from an OCI artifact","example":{"file":"tidb-v7.5.0-linux-amd64.tar.gz","repo":"hub.pingcap.net/dev/ci/tidb","tag":"v7.5.0_linux_amd64"},"required":["repo","tag","file"]},"PublishInfoTiUP":{"type":"object","properties":{"arch":{"type":"string","example":"amd64"},"description":{"type":"string","example":"TiDB GA"},"entry_point":{"type":"string","example":"bin/tidb-server"},"name":{"type":"string","example":"tidb"},"os":{"type":"string","example":"linux"},"standalone":{"type":"boolean","example":false},"version":{"type":"string","example":"v7.5.0"}},"example":{"arch":"amd64","description":"TiDB GA","entry_point":"bin/tidb-server","name":"tidb","os":"linux","standalone":false,"version":"v7.5.0"},"required":["name","os","arch","version"]},"PublishRequestTiUP":{"type":"object","properties":{"from":{"$ref":"#/components/schemas/From"},"publish":{"$ref":"#/components/schemas/PublishInfoTiUP"},"tiup_mirror":{"type":"string","description":"`staging` is http://tiup.pingcap.net:8988, `prod` is http://tiup.pingcap.net:8987.","default":"staging","example":"staging","enum":["staging","prod"]}},"example":{"from":{"http":{"url":"https://example.com/tidb-v7.5.0-linux-amd64.tar.gz"},"type":"http"},"publish":{"arch":"amd64","description":"TiDB GA","entry_point":"bin/tidb-server","name":"tidb","os":"linux","standalone":false,"version":"v7.5.0"}},"required":["from","publish"]},"RequestMultiarchCollectRequestBody":{"type":"object","properties":{"async":{"type":"boolean","description":"Whether to run the collection asynchronously. If true, returns a request id. If false or omitted, runs synchronously and returns the result directly.","default":false,"example":false},"image_url":{"type":"string","description":"The image URL to collect","example":"Ut ducimus qui quia pariatur."},"release_tag_suffix":{"type":"string","description":"Suffix for the release tag","default":"release","example":"Est nostrum in optio cupiditate placeat."}},"example":{"async":true,"image_url":"Consequatur fugit modi aliquam aut laborum.","release_tag_suffix":"Ea eaque est eum qui ad."},"required":["image_url"]},"RequestMultiarchCollectResponseBody":{"type":"object","properties":{"async":{"type":"boolean","description":"Whether to run the collection asynchronously. If true, returns a request id. If false or omitted, runs synchronously and returns the result directly.","default":false,"example":false},"repo":{"type":"string","description":"Repository of the collected image","example":"Ut eum nulla voluptates odio."},"request_id":{"type":"string","description":"Request id for async mode (uuidv4 format)","example":"6a8e8797-fe3b-4281-ba72-ee6c75c72d32","format":"uuid"},"tags":{"type":"array","items":{"type":"string","example":"Veniam voluptatem eum laboriosam magnam deserunt laudantium."},"description":"Tags of the collected image","example":["Amet sed enim optio earum.","Voluptatem rem aut eaque."]}},"example":{"async":false,"repo":"Suscipit doloremque.","request_id":"948781fe-4c3a-417e-8a2a-3628e6d60abe","tags":["Numquam occaecati voluptatibus mollitia in exercitationem nam.","Sit sequi.","Et provident commodi iusto enim repellendus.","Dolore nisi aut et."]},"required":["async"]},"RequestToCopyRequestBody":{"type":"object","properties":{"destination":{"type":"string","description":"destination image url","example":"Aut aliquam aut omnis."},"source":{"type":"string","description":"source image url","example":"Non rerum saepe in."}},"example":{"destination":"Facilis dolor impedit.","source":"Vel fugit corrupti at voluptate et magni."},"required":["source","destination"]},"RequestToPublishRequestBody":{"type":"object","properties":{"artifact_url":{"type":"string","description":"The full url of the pushed OCI artifact, contain the tag part. It will parse the repo from it.","example":"oci.com/repo:tag"},"tiup_mirror":{"type":"string","description":"`staging` is http://tiup.pingcap.net:8988, `prod` is http://tiup.pingcap.net:8987.","default":"staging","example":"staging","enum":["staging","prod"]},"version":{"type":"string","description":"Force set the version. Default is the artifact version read from `org.opencontainers.image.version` of the manifest config.","example":"v1.0.0"}},"example":{"artifact_url":"oci.com/repo:tag","tiup_mirror":"staging","version":"v1.0.0"},"required":["artifact_url","tiup_mirror"]},"TiupDeliveryResults":{"type":"object","properties":{"results":{"type":"object","example":{"staging":["a264513d-96b9-4c91-81be-e334960c7b5e","8553d70e-b798-4618-9398-cbbfe9ec0ce2"]},"additionalProperties":{"type":"array","items":{"type":"string","description":"Request id for async mode (uuidv4 format)","example":"06be863d-767d-4fcb-b90a-2691282ccfd7","format":"uuid"},"example":["2d5063e9-8d0c-447c-b57f-320d18b0a649","a25e40c5-0482-4ae3-a361-a7492e3c22aa","b8814324-31c1-40c6-9697-19e5a2965aa4"]}}},"example":{"results":{"staging":["aefdfacd-c08f-4576-9a68-40b9e153f441","fd16c80b-8685-4d1d-b5bd-36def2eac94c","9b2a9022-398b-46ca-bbd9-44a4397527d7"]}}},"UpdateComponentVersionInCloudconfigRequestBody":{"type":"object","properties":{"image":{"type":"string","description":"container image with tag","example":"xxx.com/coomponent:v8.5.4"},"stage":{"type":"string","description":"env stage","example":"prod"}},"example":{"image":"xxx.com/coomponent:v8.5.4","stage":"prod"},"required":["stage","image"]},"UpdateComponentVersionInCloudconfigResponseBody":{"type":"object","properties":{"stage":{"type":"string","example":"Consequatur suscipit accusamus."},"ticket":{"type":"object","properties":{"change_id":{"type":"string","description":"component publish flow ID","example":"Nihil maxime nesciunt sit autem."},"id":{"type":"string","description":"ticket ID","example":"Quia quo qui ut itaque dolorem."},"release_id":{"type":"string","description":"release window ID","example":"Eius eos dicta quas nobis ut magni."},"url":{"type":"string","description":"ticket visit url","example":"http://bernierrolfson.net/jo","format":"uri"}},"description":"ticket details","example":{"change_id":"Voluptatibus nemo modi earum.","id":"Velit similique.","release_id":"Voluptas ipsam natus.","url":"http://abshire.net/keon"},"required":["id"]}},"example":{"stage":"Enim exercitationem eum.","ticket":{"change_id":"Et odio rerum eos nemo labore nam.","id":"Tempora id qui reprehenderit.","release_id":"Aut voluptates voluptates fuga debitis.","url":"http://hoppe.info/rhoda"}},"required":["stage","ticket"]}}},"tags":[{"name":"tiup","description":"TiUP Publisher service"},{"name":"fileserver","description":"Publisher service for static file server "},{"name":"image","description":"Publisher service for container image"},{"name":"tidbcloud","description":"Publisher service for tidbcloud platform"}]}