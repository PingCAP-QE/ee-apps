{"openapi":"3.0.3","info":{"title":"Publish API","description":"Publish API","contact":{"name":"WuHui Zuo","url":"https://github.com/wuhuizuo","email":"wuhui.zuo@pingcap.com"},"version":"1.0.0"},"servers":[{"url":"http://0.0.0.0:80"}],"paths":{"/fs/publish-request":{"post":{"tags":["fileserver"],"summary":"request-to-publish fileserver","operationId":"fileserver#request-to-publish","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/DeliveryByRulesRequestBody"},"example":{"artifact_url":"Aspernatur eum modi numquam natus quibusdam ea."}}}},"responses":{"200":{"description":"OK response.","content":{"application/json":{"schema":{"type":"array","items":{"type":"string","description":"Request id for async mode (uuidv4 format)","example":"7b8666e7-996d-401a-92ae-724c7416ef65","format":"uuid"},"description":"request track ids","example":["c07cfd53-f083-4c26-884b-c0143c4aea06","b46537f8-bd6d-41a7-ab5b-df05a380a337","5f26be0f-b842-4600-a992-f882e5aba130"]},"example":["f0a8f6e5-8881-4f35-a8f0-96be554b57e5","8c484ffb-1100-48a3-a29d-f026c0141d86","c3b4e69b-c3f9-414d-bf6f-182433d2e719"]}}}}}},"/fs/publish-request/{request_id}":{"get":{"tags":["fileserver"],"summary":"query-publishing-status fileserver","operationId":"fileserver#query-publishing-status","parameters":[{"name":"request_id","in":"path","description":"Request id for async mode (uuidv4 format)","required":true,"schema":{"type":"string","description":"Request id for async mode (uuidv4 format)","example":"6a144ddb-4c38-4c4d-b7d4-cd1299467868","format":"uuid"},"example":"f92550ff-37fe-4a11-bedd-b774aa6596a1"}],"responses":{"200":{"description":"OK response.","content":{"application/json":{"schema":{"type":"string","description":"State of the task","example":"queued","enum":["queued","processing","success","failed","canceled"]},"example":"failed"}}}}}},"/image/collect-multiarch":{"post":{"tags":["image"],"summary":"request-multiarch-collect image","operationId":"image#request-multiarch-collect","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RequestMultiarchCollectRequestBody"},"example":{"async":false,"image_url":"Facilis et in impedit fugiat magni iure.","release_tag_suffix":"Repellendus necessitatibus."}}}},"responses":{"200":{"description":"OK response.","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RequestMultiarchCollectResponseBody"},"example":{"async":true,"repo":"Minus natus nesciunt quidem atque odio sit.","request_id":"60f1e1f6-0dc1-4dc6-851b-c44da12f6012","tags":["Ipsam molestiae.","Commodi consequuntur illum pariatur est ea."]}}}}}}},"/image/collect-multiarch/{request_id}":{"get":{"tags":["image"],"summary":"query-multiarch-collect-status image","operationId":"image#query-multiarch-collect-status","parameters":[{"name":"request_id","in":"path","description":"Request id for async mode (uuidv4 format)","required":true,"schema":{"type":"string","description":"Request id for async mode (uuidv4 format)","example":"1e4a6163-9839-4ed7-9ca1-59c5b861514a","format":"uuid"},"example":"5041946a-1281-4528-92e3-9eb44a37da3b"}],"responses":{"200":{"description":"OK response.","content":{"application/json":{"schema":{"type":"string","description":"State of the task","example":"queued","enum":["queued","processing","success","failed","canceled"]},"example":"processing"}}}}}},"/image/copy":{"post":{"tags":["image"],"summary":"request-to-copy image","operationId":"image#request-to-copy","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RequestToCopyRequestBody"},"example":{"destination":"Quis iure illo dolorum eos incidunt eius.","source":"Distinctio et labore."}}}},"responses":{"200":{"description":"OK response.","content":{"application/json":{"schema":{"type":"string","description":"Request id for async mode (uuidv4 format)","example":"67fb98ec-e09d-4625-9921-88a442e96af4","format":"uuid"},"example":"109a853d-22e9-4ab5-865d-0b9bed5f83ba"}}}}}},"/image/copy/{request_id}":{"get":{"tags":["image"],"summary":"query-copying-status image","operationId":"image#query-copying-status","parameters":[{"name":"request_id","in":"path","description":"Request id for async mode (uuidv4 format)","required":true,"schema":{"type":"string","description":"Request id for async mode (uuidv4 format)","example":"3490962e-7fab-4d88-8f32-a107f8843f22","format":"uuid"},"example":"1f6414ae-a92e-4712-a473-184f41f6f8b4"}],"responses":{"200":{"description":"OK response.","content":{"application/json":{"schema":{"type":"string","description":"State of the task","example":"canceled","enum":["queued","processing","success","failed","canceled"]},"example":"canceled"}}}}}},"/tiup/delivery-by-rules":{"post":{"tags":["tiup"],"summary":"delivery-by-rules tiup","description":"Request to delivery TiUP packages from OCI artifact controlled by delivery rules","operationId":"tiup#delivery-by-rules","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/DeliveryByRulesRequestBody"},"example":{"artifact_url":"oci.com/repo:tag"}}}},"responses":{"200":{"description":"OK response.","content":{"application/json":{"schema":{"type":"array","items":{"type":"string","example":"Et omnis commodi ut accusamus."},"description":"request track ids","example":["Qui corrupti qui qui aperiam amet.","Corporis consequatur amet voluptas facilis est illo."]},"example":["Sequi cupiditate et provident commodi iusto.","Repellendus inventore dolore.","Aut et est."]}}}}}},"/tiup/publish-request":{"post":{"tags":["tiup"],"summary":"request-to-publish tiup","description":"Request to publish TiUP packages from a OCI artifact","operationId":"tiup#request-to-publish","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RequestToPublishRequestBody"},"example":{"artifact_url":"oci.com/repo:tag","tiup_mirror":"prod","version":"v1.0.0"}}}},"responses":{"200":{"description":"OK response.","content":{"application/json":{"schema":{"type":"array","items":{"type":"string","example":"Rerum velit et."},"description":"request track ids","example":["Esse nam.","Velit quia hic.","Numquam alias."]},"example":["Suscipit doloremque.","Quos numquam occaecati voluptatibus mollitia.","Exercitationem nam."]}}}}}},"/tiup/publish-request-single":{"post":{"tags":["tiup"],"summary":"request-to-publish-single tiup","description":"Request to publish a single TiUP package from a binary tarball","operationId":"tiup#request-to-publish-single","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PublishRequestTiUP"},"example":{"from":{"http":{"url":"https://example.com/tidb-v7.5.0-linux-amd64.tar.gz"},"type":"http"},"publish":{"arch":"amd64","description":"TiDB GA","entry_point":"bin/tidb-server","name":"tidb","os":"linux","standalone":false,"version":"v7.5.0"}}}}},"responses":{"200":{"description":"OK response.","content":{"application/json":{"schema":{"type":"string","description":"Request id for async mode (uuidv4 format)","example":"4c442380-3f18-4500-9f2a-e0125db00616","format":"uuid"},"example":"6c75c73a-017e-4a2a-b628-e6d60abe3a9b"}}}}}},"/tiup/publish-request/{request_id}":{"get":{"tags":["tiup"],"summary":"query-publishing-status tiup","operationId":"tiup#query-publishing-status","parameters":[{"name":"request_id","in":"path","description":"request track id","required":true,"schema":{"type":"string","description":"request track id","example":"Ipsa consequatur suscipit accusamus."},"example":"Quia quo qui ut itaque dolorem."}],"responses":{"200":{"description":"OK response.","content":{"application/json":{"schema":{"type":"string","description":"State of the task","example":"success","enum":["queued","processing","success","failed","canceled"]},"example":"processing"}}}}}},"/tiup/reset-rate-limit":{"post":{"tags":["tiup"],"summary":"reset-rate-limit tiup","operationId":"tiup#reset-rate-limit","responses":{"200":{"description":"OK response."}}}}},"components":{"schemas":{"DeliveryByRulesRequestBody":{"type":"object","properties":{"artifact_url":{"type":"string","description":"The full url of the pushed OCI artifact, contain the tag part. It will parse the repo from it.","example":"oci.com/repo:tag"}},"example":{"artifact_url":"oci.com/repo:tag"},"required":["artifact_url"]},"From":{"type":"object","properties":{"http":{"$ref":"#/components/schemas/FromHTTP"},"oci":{"$ref":"#/components/schemas/FromOci"},"type":{"type":"string","example":"oci","enum":["oci","http"]}},"example":{"http":{"url":"https://example.com/tidb-v7.5.0-linux-amd64.tar.gz"},"type":"http"},"required":["type"]},"FromHTTP":{"type":"object","properties":{"url":{"type":"string","example":"https://example.com/tidb-v7.5.0-linux-amd64.tar.gz"}},"description":"Source from a direct HTTP URL","example":{"url":"https://example.com/tidb-v7.5.0-linux-amd64.tar.gz"},"required":["url"]},"FromOci":{"type":"object","properties":{"file":{"type":"string","example":"tidb-v7.5.0-linux-amd64.tar.gz"},"repo":{"type":"string","example":"hub.pingcap.net/dev/ci/tidb"},"tag":{"type":"string","example":"v7.5.0_linux_amd64"}},"description":"Source from an OCI artifact","example":{"file":"tidb-v7.5.0-linux-amd64.tar.gz","repo":"hub.pingcap.net/dev/ci/tidb","tag":"v7.5.0_linux_amd64"},"required":["repo","tag","file"]},"PublishInfoTiUP":{"type":"object","properties":{"arch":{"type":"string","example":"amd64"},"description":{"type":"string","example":"TiDB GA"},"entry_point":{"type":"string","example":"bin/tidb-server"},"name":{"type":"string","example":"tidb"},"os":{"type":"string","example":"linux"},"standalone":{"type":"boolean","example":false},"version":{"type":"string","example":"v7.5.0"}},"example":{"arch":"amd64","description":"TiDB GA","entry_point":"bin/tidb-server","name":"tidb","os":"linux","standalone":false,"version":"v7.5.0"},"required":["name","os","arch","version"]},"PublishRequestTiUP":{"type":"object","properties":{"from":{"$ref":"#/components/schemas/From"},"publish":{"$ref":"#/components/schemas/PublishInfoTiUP"},"tiup_mirror":{"type":"string","description":"`staging` is http://tiup.pingcap.net:8988, `prod` is http://tiup.pingcap.net:8987.","default":"staging","example":"staging","enum":["staging","prod"]}},"example":{"from":{"http":{"url":"https://example.com/tidb-v7.5.0-linux-amd64.tar.gz"},"type":"http"},"publish":{"arch":"amd64","description":"TiDB GA","entry_point":"bin/tidb-server","name":"tidb","os":"linux","standalone":false,"version":"v7.5.0"}},"required":["from","publish"]},"RequestMultiarchCollectRequestBody":{"type":"object","properties":{"async":{"type":"boolean","description":"Whether to run the collection asynchronously. If true, returns a request id. If false or omitted, runs synchronously and returns the result directly.","default":false,"example":true},"image_url":{"type":"string","description":"The image URL to collect","example":"Placeat rerum velit sunt quis necessitatibus repellat."},"release_tag_suffix":{"type":"string","description":"Suffix for the release tag","default":"release","example":"Error voluptatem illum labore iste cumque omnis."}},"example":{"async":true,"image_url":"Animi quia non rerum saepe.","release_tag_suffix":"Ad aut aliquam aut omnis magni vel."},"required":["image_url"]},"RequestMultiarchCollectResponseBody":{"type":"object","properties":{"async":{"type":"boolean","description":"Whether to run the collection asynchronously. If true, returns a request id. If false or omitted, runs synchronously and returns the result directly.","default":false,"example":true},"repo":{"type":"string","description":"Repository of the collected image","example":"Voluptate et magni sit."},"request_id":{"type":"string","description":"Request id for async mode (uuidv4 format)","example":"093c2e08-75cd-42db-b5b5-2f08cd479cf4","format":"uuid"},"tags":{"type":"array","items":{"type":"string","example":"Dolor impedit ab pariatur fuga natus."},"description":"Tags of the collected image","example":["Illum eius quibusdam expedita qui necessitatibus qui.","Doloribus ipsam maiores ut in delectus a.","Natus optio.","Voluptate reprehenderit deserunt explicabo."]}},"example":{"async":false,"repo":"Ut eum nulla voluptates odio.","request_id":"20626555-f76a-4e87-97fe-3bd281ba72ee","tags":["Voluptatem eum laboriosam magnam deserunt laudantium.","Nam amet sed enim optio earum.","Voluptatem rem aut eaque."]},"required":["async"]},"RequestToCopyRequestBody":{"type":"object","properties":{"destination":{"type":"string","description":"destination image url","example":"Tempora illo beatae aut."},"source":{"type":"string","description":"source image url","example":"A earum."}},"example":{"destination":"Ab numquam ipsam aperiam.","source":"Non expedita explicabo ut qui nihil vero."},"required":["source","destination"]},"RequestToPublishRequestBody":{"type":"object","properties":{"artifact_url":{"type":"string","description":"The full url of the pushed OCI artifact, contain the tag part. It will parse the repo from it.","example":"oci.com/repo:tag"},"tiup_mirror":{"type":"string","description":"`staging` is http://tiup.pingcap.net:8988, `prod` is http://tiup.pingcap.net:8987.","default":"staging","example":"prod","enum":["staging","prod"]},"version":{"type":"string","description":"Force set the version. Default is the artifact version read from `org.opencontainers.image.version` of the manifest config.","example":"v1.0.0"}},"example":{"artifact_url":"oci.com/repo:tag","tiup_mirror":"staging","version":"v1.0.0"},"required":["artifact_url","tiup_mirror"]},"TiupDeliveryResults":{"type":"object","properties":{"results":{"type":"object","example":{"prod":["8900c38d-0704-4538-9a0c-6b5c9401ace8","5f2b0dc4-b599-457e-907a-1428e809f3ea","0b8a7cf1-75a8-4568-9aa6-ba9f8e0969e8","3fc306be-be4d-42cb-8afd-c8d146f45d42"]},"additionalProperties":{"type":"array","items":{"type":"string","description":"Request id for async mode (uuidv4 format)","example":"c09cd051-71aa-4b68-af17-9834f1c05949","format":"uuid"},"example":["7bfc18b3-514f-4a25-bd38-5e405ae7811f","b2062ed2-f7fa-4c83-81c7-a5c94a9447dc","69f48e81-6383-4b20-9bab-91a9d44b365c"]}}},"example":{"results":{"prod":["e750aa58-f877-4011-a194-f11a0c452def","5bcbbaa2-ac3a-43db-b439-17c234940422"]}}}}},"tags":[{"name":"tiup","description":"TiUP Publisher service"},{"name":"fileserver","description":"Publisher service for static file server "},{"name":"image","description":"Publisher service for container image"}]}
