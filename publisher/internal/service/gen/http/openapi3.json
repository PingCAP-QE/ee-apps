{"openapi":"3.0.3","info":{"title":"Publish API","description":"Publish API","contact":{"name":"WuHui Zuo","url":"https://github.com/wuhuizuo","email":"wuhui.zuo@pingcap.com"},"version":"1.0.0"},"servers":[{"url":"http://0.0.0.0:80"}],"paths":{"/fs/publish-request":{"post":{"tags":["fileserver"],"summary":"request-to-publish fileserver","operationId":"fileserver#request-to-publish","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/DeliveryByRulesRequestBody"},"example":{"artifact_url":"Velit praesentium est."}}}},"responses":{"200":{"description":"OK response.","content":{"application/json":{"schema":{"type":"array","items":{"type":"string","description":"Request id for async mode (uuidv4 format)","example":"b4da5b28-c586-4a3f-84c9-d6a684cc796b","format":"uuid"},"description":"request track ids","example":["bc5c83c4-60fd-4297-87d6-df0f3755100c","06b0f1c4-e3ff-4b52-bbc5-9c653ced07bd","1c1fb0ac-b2d9-415d-9afc-c28cf7dd36bb"]},"example":["30161d3f-9f64-4e66-879c-5c791c5f0303","232ea776-a894-4bf3-adcb-71ed239dbe9f"]}}}}}},"/fs/publish-request/{request_id}":{"get":{"tags":["fileserver"],"summary":"query-publishing-status fileserver","operationId":"fileserver#query-publishing-status","parameters":[{"name":"request_id","in":"path","description":"Request id for async mode (uuidv4 format)","required":true,"schema":{"type":"string","description":"Request id for async mode (uuidv4 format)","example":"9859e72b-a565-46b2-8031-f1112c848741","format":"uuid"},"example":"d932cbe3-0534-43fd-8b2b-c5e1d1082e21"}],"responses":{"200":{"description":"OK response.","content":{"application/json":{"schema":{"type":"string","description":"State of the task","example":"queued","enum":["queued","processing","success","failed","canceled"]},"example":"canceled"}}}}}},"/image/collect-multiarch":{"post":{"tags":["image"],"summary":"request-multiarch-collect image","operationId":"image#request-multiarch-collect","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RequestMultiarchCollectRequestBody"},"example":{"async":false,"image_url":"Voluptatibus quas aut.","release_tag_suffix":"Dolor deleniti id earum."}}}},"responses":{"200":{"description":"OK response.","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RequestMultiarchCollectResponseBody"},"example":{"async":false,"repo":"Ipsam id ipsa.","request_id":"e8c6ec54-d74c-4516-a8de-88ec9a45e2ab","tags":["Saepe sapiente non ea.","Nemo deserunt sint et."]}}}}}}},"/image/collect-multiarch/{request_id}":{"get":{"tags":["image"],"summary":"query-multiarch-collect-status image","operationId":"image#query-multiarch-collect-status","parameters":[{"name":"request_id","in":"path","description":"Request id for async mode (uuidv4 format)","required":true,"schema":{"type":"string","description":"Request id for async mode (uuidv4 format)","example":"7e26b8c3-4ba8-473b-b6e6-9dbe3c071a82","format":"uuid"},"example":"93c45ecc-55a5-437e-85dc-1d37f94844ac"}],"responses":{"200":{"description":"OK response.","content":{"application/json":{"schema":{"type":"string","description":"State of the task","example":"success","enum":["queued","processing","success","failed","canceled"]},"example":"queued"}}}}}},"/image/copy":{"post":{"tags":["image"],"summary":"request-to-copy image","operationId":"image#request-to-copy","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RequestToCopyRequestBody"},"example":{"destination":"Sit pariatur quis id sunt dignissimos accusantium.","source":"Et sed doloremque officiis accusantium ab."}}}},"responses":{"200":{"description":"OK response.","content":{"application/json":{"schema":{"type":"string","description":"Request id for async mode (uuidv4 format)","example":"cab17e24-bbc3-4dd8-a1fd-a91cd3f8c7a9","format":"uuid"},"example":"4f9a5c2d-22e8-4f12-868a-dfed1d778ee4"}}}}}},"/image/copy/{request_id}":{"get":{"tags":["image"],"summary":"query-copying-status image","operationId":"image#query-copying-status","parameters":[{"name":"request_id","in":"path","description":"Request id for async mode (uuidv4 format)","required":true,"schema":{"type":"string","description":"Request id for async mode (uuidv4 format)","example":"f5de862c-f7d7-4dee-ac71-7cbadc5c2560","format":"uuid"},"example":"f35257af-c3fb-4c57-9fd9-2dcb86a59ead"}],"responses":{"200":{"description":"OK response.","content":{"application/json":{"schema":{"type":"string","description":"State of the task","example":"failed","enum":["queued","processing","success","failed","canceled"]},"example":"processing"}}}}}},"/tidbcloud/devops/cloudconfig/versions/component":{"post":{"tags":["tidbcloud"],"summary":"update-component-version-in-cloudconfig tidbcloud","operationId":"tidbcloud#update-component-version-in-cloudconfig","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UpdateComponentVersionInCloudconfigRequestBody"},"example":{"image":"xxx.com/component:v8.5.4","stage":"prod"}}}},"responses":{"200":{"description":"OK response.","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UpdateComponentVersionInCloudconfigResponseBody"},"example":{"stage":"Occaecati est animi recusandae.","tickets":[{"change_id":"Necessitatibus veritatis.","component":"Qui unde reiciendis quibusdam quibusdam veniam.","component_version":"Rerum excepturi omnis autem sequi saepe.","id":"Occaecati animi.","release_id":"Officiis corrupti reprehenderit.","url":"http://schuppe.name/nelda"},{"change_id":"Necessitatibus veritatis.","component":"Qui unde reiciendis quibusdam quibusdam veniam.","component_version":"Rerum excepturi omnis autem sequi saepe.","id":"Occaecati animi.","release_id":"Officiis corrupti reprehenderit.","url":"http://schuppe.name/nelda"}]}}}}}}},"/tidbcloud/tidbx-component-image-builds":{"post":{"tags":["tidbcloud"],"summary":"add-tidbx-image-tag-in-tcms tidbcloud","operationId":"tidbcloud#add-tidbx-image-tag-in-tcms","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/AddTidbxImageTagInTcmsRequestBody"},"example":{"github":{"commit_sha":"031069dfc0c70e839d996c9e1cf3d34930fc662f","full_repo":"pingcap/tidb","ref":"refs/heads/master"},"image":"xxx.com/component:v8.5.4"}}}},"responses":{"200":{"description":"OK response.","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AddTidbxImageTagInTcmsResponseBody"},"example":{"branch":"release-nextgen-20251011","imageTag":"release-nextgen-20251011-031069d","repo":"pingcap/tidb","sha":"031069dfc0c70e839d996c9e1cf3d34930fc662f"}}}}}}},"/tiup/delivery-by-rules":{"post":{"tags":["tiup"],"summary":"delivery-by-rules tiup","description":"Request to delivery TiUP packages from OCI artifact controlled by delivery rules","operationId":"tiup#delivery-by-rules","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/DeliveryByRulesRequestBody"},"example":{"artifact_url":"oci.com/repo:tag"}}}},"responses":{"200":{"description":"OK response.","content":{"application/json":{"schema":{"type":"array","items":{"type":"string","example":"Quibusdam doloribus fugiat aut."},"description":"request track ids","example":["Cum quia laboriosam facere.","Eum pariatur voluptas voluptas sapiente."]},"example":["Vero aut voluptates voluptates fuga debitis.","Et odio rerum eos nemo labore nam.","Quaerat corrupti ea rem."]}}}}}},"/tiup/publish-request":{"post":{"tags":["tiup"],"summary":"request-to-publish tiup","description":"Request to publish TiUP packages from a OCI artifact","operationId":"tiup#request-to-publish","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RequestToPublishRequestBody"},"example":{"artifact_url":"oci.com/repo:tag","tiup_mirror":"staging","version":"v1.0.0"}}}},"responses":{"200":{"description":"OK response.","content":{"application/json":{"schema":{"type":"array","items":{"type":"string","example":"Iure dolores adipisci."},"description":"request track ids","example":["Ex esse ut ab dolorem eos quas.","Voluptas ea."]},"example":["Sint est sit fuga.","Magnam magnam sit quod eum et.","Nostrum officia eligendi eos architecto nihil.","Qui numquam alias est et impedit."]}}}}}},"/tiup/publish-request-single":{"post":{"tags":["tiup"],"summary":"request-to-publish-single tiup","description":"Request to publish a single TiUP package from a binary tarball","operationId":"tiup#request-to-publish-single","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PublishRequestTiUP"},"example":{"from":{"http":{"url":"https://example.com/tidb-v7.5.0-linux-amd64.tar.gz"},"type":"http"},"publish":{"arch":"amd64","description":"TiDB GA","entry_point":"bin/tidb-server","name":"tidb","os":"linux","standalone":false,"version":"v7.5.0"}}}}},"responses":{"200":{"description":"OK response.","content":{"application/json":{"schema":{"type":"string","description":"Request id for async mode (uuidv4 format)","example":"0ca90f75-2130-4732-8af1-a7fd12abd827","format":"uuid"},"example":"932e69d3-3bd5-41c8-8760-e8dbed5b38cc"}}}}}},"/tiup/publish-request/{request_id}":{"get":{"tags":["tiup"],"summary":"query-publishing-status tiup","operationId":"tiup#query-publishing-status","parameters":[{"name":"request_id","in":"path","description":"request track id","required":true,"schema":{"type":"string","description":"request track id","example":"Quae quia architecto nobis."},"example":"Omnis impedit."}],"responses":{"200":{"description":"OK response.","content":{"application/json":{"schema":{"type":"string","description":"State of the task","example":"canceled","enum":["queued","processing","success","failed","canceled"]},"example":"success"}}}}}},"/tiup/reset-rate-limit":{"post":{"tags":["tiup"],"summary":"reset-rate-limit tiup","operationId":"tiup#reset-rate-limit","responses":{"200":{"description":"OK response."}}}}},"components":{"schemas":{"AddTidbxImageTagInTcmsRequestBody":{"type":"object","properties":{"github":{"type":"object","properties":{"commit_sha":{"type":"string","description":"full commit SHA","example":"031069dfc0c70e839d996c9e1cf3d34930fc662f","minLength":40,"maxLength":40},"full_repo":{"type":"string","description":"full github repo name","example":"pingcap/tidb"},"ref":{"type":"string","description":"git ref","example":"refs/heads/master"}},"description":"git informations","example":{"commit_sha":"031069dfc0c70e839d996c9e1cf3d34930fc662f","full_repo":"pingcap/tidb","ref":"refs/heads/master"},"required":["full_repo","commit_sha"]},"image":{"type":"string","description":"container image with tag","example":"xxx.com/component:v8.5.4"}},"example":{"github":{"commit_sha":"031069dfc0c70e839d996c9e1cf3d34930fc662f","full_repo":"pingcap/tidb","ref":"refs/heads/master"},"image":"xxx.com/component:v8.5.4"},"required":["image"]},"AddTidbxImageTagInTcmsResponseBody":{"type":"object","properties":{"branch":{"type":"string","description":"github branch or tag name","example":"release-nextgen-20251011"},"imageTag":{"type":"string","description":"image tag","example":"release-nextgen-20251011-031069d"},"repo":{"type":"string","description":"github full repo","example":"pingcap/tidb"},"sha":{"type":"string","description":"github commit sha in the repo","example":"031069dfc0c70e839d996c9e1cf3d34930fc662f"}},"example":{"branch":"release-nextgen-20251011","imageTag":"release-nextgen-20251011-031069d","repo":"pingcap/tidb","sha":"031069dfc0c70e839d996c9e1cf3d34930fc662f"}},"DeliveryByRulesRequestBody":{"type":"object","properties":{"artifact_url":{"type":"string","description":"The full url of the pushed OCI artifact, contain the tag part. It will parse the repo from it.","example":"oci.com/repo:tag"}},"example":{"artifact_url":"oci.com/repo:tag"},"required":["artifact_url"]},"From":{"type":"object","properties":{"http":{"$ref":"#/components/schemas/FromHTTP"},"oci":{"$ref":"#/components/schemas/FromOci"},"type":{"type":"string","example":"http","enum":["oci","http"]}},"example":{"http":{"url":"https://example.com/tidb-v7.5.0-linux-amd64.tar.gz"},"type":"http"},"required":["type"]},"FromHTTP":{"type":"object","properties":{"url":{"type":"string","example":"https://example.com/tidb-v7.5.0-linux-amd64.tar.gz"}},"description":"Source from a direct HTTP URL","example":{"url":"https://example.com/tidb-v7.5.0-linux-amd64.tar.gz"},"required":["url"]},"FromOci":{"type":"object","properties":{"file":{"type":"string","example":"tidb-v7.5.0-linux-amd64.tar.gz"},"repo":{"type":"string","example":"hub.pingcap.net/dev/ci/tidb"},"tag":{"type":"string","example":"v7.5.0_linux_amd64"}},"description":"Source from an OCI artifact","example":{"file":"tidb-v7.5.0-linux-amd64.tar.gz","repo":"hub.pingcap.net/dev/ci/tidb","tag":"v7.5.0_linux_amd64"},"required":["repo","tag","file"]},"PublishInfoTiUP":{"type":"object","properties":{"arch":{"type":"string","example":"amd64"},"description":{"type":"string","example":"TiDB GA"},"entry_point":{"type":"string","example":"bin/tidb-server"},"name":{"type":"string","example":"tidb"},"os":{"type":"string","example":"linux"},"standalone":{"type":"boolean","example":false},"version":{"type":"string","example":"v7.5.0"}},"example":{"arch":"amd64","description":"TiDB GA","entry_point":"bin/tidb-server","name":"tidb","os":"linux","standalone":false,"version":"v7.5.0"},"required":["name","os","arch","version"]},"PublishRequestTiUP":{"type":"object","properties":{"from":{"$ref":"#/components/schemas/From"},"publish":{"$ref":"#/components/schemas/PublishInfoTiUP"},"tiup_mirror":{"type":"string","description":"`staging` is http://tiup.pingcap.net:8988, `prod` is http://tiup.pingcap.net:8987.","default":"staging","example":"staging","enum":["staging","prod"]}},"example":{"from":{"http":{"url":"https://example.com/tidb-v7.5.0-linux-amd64.tar.gz"},"type":"http"},"publish":{"arch":"amd64","description":"TiDB GA","entry_point":"bin/tidb-server","name":"tidb","os":"linux","standalone":false,"version":"v7.5.0"}},"required":["from","publish"]},"RequestMultiarchCollectRequestBody":{"type":"object","properties":{"async":{"type":"boolean","description":"Whether to run the collection asynchronously. If true, returns a request id. If false or omitted, runs synchronously and returns the result directly.","default":false,"example":false},"image_url":{"type":"string","description":"The image URL to collect","example":"Saepe aspernatur porro."},"release_tag_suffix":{"type":"string","description":"Suffix for the release tag","default":"release","example":"Voluptatem similique recusandae assumenda tempora quo."}},"example":{"async":true,"image_url":"Suscipit sequi aperiam ipsa consequatur suscipit.","release_tag_suffix":"Consequatur quia quo qui ut."},"required":["image_url"]},"RequestMultiarchCollectResponseBody":{"type":"object","properties":{"async":{"type":"boolean","description":"Whether to run the collection asynchronously. If true, returns a request id. If false or omitted, runs synchronously and returns the result directly.","default":false,"example":false},"repo":{"type":"string","description":"Repository of the collected image","example":"Tenetur inventore."},"request_id":{"type":"string","description":"Request id for async mode (uuidv4 format)","example":"b1c4cc93-9ab5-4a13-81df-700a24eb9801","format":"uuid"},"tags":{"type":"array","items":{"type":"string","example":"Sit qui culpa et temporibus aut sunt."},"description":"Tags of the collected image","example":["Soluta quae repudiandae animi est temporibus.","Corporis possimus.","Ut voluptas accusamus ut et.","Ut iure."]}},"example":{"async":true,"repo":"Voluptates adipisci ab quis aliquam.","request_id":"6cc58d87-d404-4df9-b11b-1613bcade6b6","tags":["Sit qui incidunt.","Explicabo harum aperiam omnis sed repudiandae aut."]},"required":["async"]},"RequestToCopyRequestBody":{"type":"object","properties":{"destination":{"type":"string","description":"destination image url","example":"Asperiores aperiam quidem et ut suscipit doloremque."},"source":{"type":"string","description":"source image url","example":"Consequatur fuga sit quas cupiditate."}},"example":{"destination":"Exercitationem nam.","source":"Quos numquam occaecati voluptatibus mollitia."},"required":["source","destination"]},"RequestToPublishRequestBody":{"type":"object","properties":{"artifact_url":{"type":"string","description":"The full url of the pushed OCI artifact, contain the tag part. It will parse the repo from it.","example":"oci.com/repo:tag"},"tiup_mirror":{"type":"string","description":"`staging` is http://tiup.pingcap.net:8988, `prod` is http://tiup.pingcap.net:8987.","default":"staging","example":"staging","enum":["staging","prod"]},"version":{"type":"string","description":"Force set the version. Default is the artifact version read from `org.opencontainers.image.version` of the manifest config.","example":"v1.0.0"}},"example":{"artifact_url":"oci.com/repo:tag","tiup_mirror":"prod","version":"v1.0.0"},"required":["artifact_url","tiup_mirror"]},"TidbcloudOpsTicket":{"type":"object","properties":{"change_id":{"type":"string","description":"component publish flow ID","example":"Et earum aspernatur unde ducimus minus."},"component":{"type":"string","description":"component name","example":"Nihil sunt odit."},"component_version":{"type":"string","description":"component version derived from image tag","example":"Et modi voluptatem expedita."},"id":{"type":"string","description":"ticket ID","example":"Ad dolore sit expedita qui."},"release_id":{"type":"string","description":"release window ID","example":"Nulla minima unde et."},"url":{"type":"string","description":"ticket visit url","example":"http://hilpert.info/jeffrey.heidenreich","format":"uri"}},"description":"Ops ticket details","example":{"change_id":"Consequatur quo similique et facilis.","component":"Inventore odio est consequuntur exercitationem.","component_version":"Ut veritatis quasi.","id":"Aliquam non voluptatibus temporibus.","release_id":"Consequatur ut ea.","url":"http://bogisich.com/josiane"},"required":["id","url","component","component_version"]},"TiupDeliveryResults":{"type":"object","properties":{"results":{"type":"object","example":{"staging":["53a2c1fb-8d3e-4f99-be74-1d83009fd03d","a865ca4e-67a8-4d0c-b823-1073e9b2f93f"]},"additionalProperties":{"type":"array","items":{"type":"string","description":"Request id for async mode (uuidv4 format)","example":"c29fe702-c780-49e2-811f-bd76d1416b56","format":"uuid"},"example":["31df2869-78c3-4af4-8689-bd6bd43ad5e9","08e2a538-e90f-45af-ab21-9c7c4bed8b8a","5f8971d9-3d6b-467d-839b-feab2076a7dd","98f4ec3e-50b5-4f09-bb77-d29ab13f4edf"]}}},"example":{"results":{"staging":["3494b654-0b44-485f-a32c-b579c1d27e99","0a458792-6ef3-47c3-a44b-55299370803a"]}}},"UpdateComponentVersionInCloudconfigRequestBody":{"type":"object","properties":{"image":{"type":"string","description":"container image with tag","example":"xxx.com/component:v8.5.4"},"stage":{"type":"string","description":"env stage","example":"prod"}},"example":{"image":"xxx.com/component:v8.5.4","stage":"prod"},"required":["stage","image"]},"UpdateComponentVersionInCloudconfigResponseBody":{"type":"object","properties":{"stage":{"type":"string","example":"Iste voluptates id consectetur labore ut."},"tickets":{"type":"array","items":{"$ref":"#/components/schemas/TidbcloudOpsTicket"},"example":[{"change_id":"Necessitatibus veritatis.","component":"Qui unde reiciendis quibusdam quibusdam veniam.","component_version":"Rerum excepturi omnis autem sequi saepe.","id":"Occaecati animi.","release_id":"Officiis corrupti reprehenderit.","url":"http://schuppe.name/nelda"},{"change_id":"Necessitatibus veritatis.","component":"Qui unde reiciendis quibusdam quibusdam veniam.","component_version":"Rerum excepturi omnis autem sequi saepe.","id":"Occaecati animi.","release_id":"Officiis corrupti reprehenderit.","url":"http://schuppe.name/nelda"},{"change_id":"Necessitatibus veritatis.","component":"Qui unde reiciendis quibusdam quibusdam veniam.","component_version":"Rerum excepturi omnis autem sequi saepe.","id":"Occaecati animi.","release_id":"Officiis corrupti reprehenderit.","url":"http://schuppe.name/nelda"},{"change_id":"Necessitatibus veritatis.","component":"Qui unde reiciendis quibusdam quibusdam veniam.","component_version":"Rerum excepturi omnis autem sequi saepe.","id":"Occaecati animi.","release_id":"Officiis corrupti reprehenderit.","url":"http://schuppe.name/nelda"}]}},"example":{"stage":"Commodi possimus voluptatem harum qui.","tickets":[{"change_id":"Necessitatibus veritatis.","component":"Qui unde reiciendis quibusdam quibusdam veniam.","component_version":"Rerum excepturi omnis autem sequi saepe.","id":"Occaecati animi.","release_id":"Officiis corrupti reprehenderit.","url":"http://schuppe.name/nelda"},{"change_id":"Necessitatibus veritatis.","component":"Qui unde reiciendis quibusdam quibusdam veniam.","component_version":"Rerum excepturi omnis autem sequi saepe.","id":"Occaecati animi.","release_id":"Officiis corrupti reprehenderit.","url":"http://schuppe.name/nelda"},{"change_id":"Necessitatibus veritatis.","component":"Qui unde reiciendis quibusdam quibusdam veniam.","component_version":"Rerum excepturi omnis autem sequi saepe.","id":"Occaecati animi.","release_id":"Officiis corrupti reprehenderit.","url":"http://schuppe.name/nelda"},{"change_id":"Necessitatibus veritatis.","component":"Qui unde reiciendis quibusdam quibusdam veniam.","component_version":"Rerum excepturi omnis autem sequi saepe.","id":"Occaecati animi.","release_id":"Officiis corrupti reprehenderit.","url":"http://schuppe.name/nelda"}]},"required":["stage","tickets"]}}},"tags":[{"name":"tiup","description":"TiUP Publisher service"},{"name":"fileserver","description":"Publisher service for static file server "},{"name":"image","description":"Publisher service for container image"},{"name":"tidbcloud","description":"Publisher service for tidbcloud platform"}]}
