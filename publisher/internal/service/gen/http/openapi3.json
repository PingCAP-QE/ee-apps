{"openapi":"3.0.3","info":{"title":"Publish API","description":"Publish API","contact":{"name":"WuHui Zuo","url":"https://github.com/wuhuizuo","email":"wuhui.zuo@pingcap.com"},"version":"1.0.0"},"servers":[{"url":"http://0.0.0.0:80"}],"paths":{"/fs/publish-request":{"post":{"tags":["fileserver"],"summary":"request-to-publish fileserver","operationId":"fileserver#request-to-publish","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RequestToPublishRequestBody2"},"example":{"artifact_url":"Omnis provident minima est."}}}},"responses":{"200":{"description":"OK response.","content":{"application/json":{"schema":{"type":"array","items":{"type":"string","example":"A aperiam non est facere impedit voluptas."},"description":"request track ids","example":["Voluptatem et aliquid.","Laboriosam culpa exercitationem est expedita saepe.","Tempore aut corporis quibusdam ipsam.","Dolores tempora."]},"example":["Magni iure.","Repellendus necessitatibus.","Ea quis minus natus nesciunt."]}}}}}},"/fs/publish-request/{request_id}":{"get":{"tags":["fileserver"],"summary":"query-publishing-status fileserver","operationId":"fileserver#query-publishing-status","parameters":[{"name":"request_id","in":"path","description":"request track id","required":true,"schema":{"type":"string","description":"request track id","example":"Atque odio sit quia dolores ipsam molestiae."},"example":"Commodi consequuntur illum pariatur est ea."}],"responses":{"200":{"description":"OK response.","content":{"application/json":{"schema":{"type":"string","description":"request state","example":"canceled","enum":["queued","processing","success","failed","canceled"]},"example":"processing"}}}}}},"/image/collect-multiarch":{"post":{"tags":["image"],"summary":"request-multiarch-collect image","operationId":"image#request-multiarch-collect","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RequestMultiarchCollectRequestBody"},"example":{"async":true,"image_url":"Doloribus laboriosam.","release_tag_suffix":"Aut voluptates quia nostrum odio molestiae ab."}}}},"responses":{"200":{"description":"OK response.","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RequestMultiarchCollectResponseBody"},"example":{"async":false,"repo":"Est quia nihil tempora consequatur exercitationem exercitationem.","request_id":"ef4eae0e-185d-4f55-bae4-ceb24bdeaee5","tags":["Quo atque et.","Doloremque ea rerum alias excepturi facilis ab.","Modi quia iste.","Amet quo laboriosam nihil aut facere."]}}}}}}},"/image/collect-multiarch/{request_id}":{"get":{"tags":["image"],"summary":"query-multiarch-collect-status image","operationId":"image#query-multiarch-collect-status","parameters":[{"name":"request_id","in":"path","description":"Request track id","required":true,"schema":{"type":"string","description":"Request track id","example":"330cb51d-3420-4cdd-90c5-5230c139505a","format":"uuid"},"example":"db0028a8-960c-4876-b888-f8685e79663b"}],"responses":{"200":{"description":"OK response.","content":{"application/json":{"schema":{"type":"string","description":"request state","example":"failed","enum":["queued","processing","success","failed","canceled"]},"example":"processing"}}}}}},"/image/copy":{"post":{"tags":["image"],"summary":"request-to-copy image","operationId":"image#request-to-copy","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RequestToCopyRequestBody"},"example":{"destination":"Sed molestiae.","source":"Delectus nesciunt beatae distinctio explicabo."}}}},"responses":{"200":{"description":"OK response.","content":{"application/json":{"schema":{"type":"string","description":"request id","example":"ea4d6ca2-0095-43fe-b2fb-fc51ab41cc03","format":"uuid"},"example":"4da12f60-121c-4953-a0ca-9e78acef70f3"}}}}}},"/image/copy/{request_id}":{"get":{"tags":["image"],"summary":"query-copying-status image","operationId":"image#query-copying-status","parameters":[{"name":"request_id","in":"path","description":"request track id","required":true,"schema":{"type":"string","description":"request track id","example":"10c9af3f-03ce-47e2-9327-f9d126f86750","format":"uuid"},"example":"ce6eb7bf-1954-4b07-a8d4-43188a5d6863"}],"responses":{"200":{"description":"OK response.","content":{"application/json":{"schema":{"type":"string","description":"request state","example":"queued","enum":["queued","processing","success","failed","canceled"]},"example":"processing"}}}}}},"/tiup/publish-request":{"post":{"tags":["tiup"],"summary":"request-to-publish tiup","operationId":"tiup#request-to-publish","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RequestToPublishRequestBody"},"example":{"artifact_url":"https://example.com/artifact.tar.gz","tiup-mirror":"Facere odio et cupiditate ut exercitationem sunt.","version":"v1.0.0"}}}},"responses":{"200":{"description":"OK response.","content":{"application/json":{"schema":{"type":"array","items":{"type":"string","example":"Non inventore voluptatem odit ea."},"description":"request track ids","example":["Libero commodi expedita laudantium consequatur.","Sapiente esse eligendi laboriosam consectetur.","Aut repudiandae iusto.","Blanditiis doloribus rem."]},"example":["Iusto fugiat ab nemo qui inventore.","Iste ut est debitis consequatur autem aliquam.","Consequatur sint suscipit quisquam praesentium.","Itaque officiis tenetur delectus tempora aut voluptates."]}}}}}},"/tiup/publish-request-single":{"post":{"tags":["tiup"],"summary":"request-to-publish-single tiup","description":"Request to publish a single TiUP package from a binary tarball","operationId":"tiup#request-to-publish-single","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PublishRequestTiUP"},"example":{"from":{"http":{"url":"https://example.com/tidb-v7.5.0-linux-amd64.tar.gz"},"type":"http"},"publish":{"arch":"amd64","description":"TiDB GA","entry_point":"bin/tidb-server","name":"tidb","os":"linux","standalone":false,"version":"v7.5.0"}}}}},"responses":{"200":{"description":"OK response.","content":{"application/json":{"schema":{"type":"string","description":"request id","example":"94a283f1-e1c8-4ffd-81cc-4122b99bcf28","format":"uuid"},"example":"26a77454-7145-48c9-830b-0ee2bec6aa0b"}}}}}},"/tiup/publish-request/{request_id}":{"get":{"tags":["tiup"],"summary":"query-publishing-status tiup","operationId":"tiup#query-publishing-status","parameters":[{"name":"request_id","in":"path","description":"request track id","required":true,"schema":{"type":"string","description":"request track id","example":"Totam fugit."},"example":"Quasi facilis et."}],"responses":{"200":{"description":"OK response.","content":{"application/json":{"schema":{"type":"string","description":"request state","example":"queued","enum":["queued","processing","success","failed","canceled"]},"example":"success"}}}}}},"/tiup/reset-rate-limit":{"post":{"tags":["tiup"],"summary":"reset-rate-limit tiup","operationId":"tiup#reset-rate-limit","responses":{"200":{"description":"OK response."}}}}},"components":{"schemas":{"From":{"type":"object","properties":{"http":{"$ref":"#/components/schemas/FromHTTP"},"oci":{"$ref":"#/components/schemas/FromOci"},"type":{"type":"string","example":"oci","enum":["oci","http"]}},"example":{"http":{"url":"https://example.com/tidb-v7.5.0-linux-amd64.tar.gz"},"type":"http"},"required":["type"]},"FromHTTP":{"type":"object","properties":{"url":{"type":"string","example":"https://example.com/tidb-v7.5.0-linux-amd64.tar.gz"}},"description":"Source from a direct HTTP URL","example":{"url":"https://example.com/tidb-v7.5.0-linux-amd64.tar.gz"},"required":["url"]},"FromOci":{"type":"object","properties":{"file":{"type":"string","example":"tidb-v7.5.0-linux-amd64.tar.gz"},"repo":{"type":"string","example":"hub.pingcap.net/dev/ci/tidb"},"tag":{"type":"string","example":"v7.5.0_linux_amd64"}},"description":"Source from an OCI artifact","example":{"file":"tidb-v7.5.0-linux-amd64.tar.gz","repo":"hub.pingcap.net/dev/ci/tidb","tag":"v7.5.0_linux_amd64"},"required":["repo","tag","file"]},"PublishInfoTiUP":{"type":"object","properties":{"arch":{"type":"string","example":"amd64"},"description":{"type":"string","example":"TiDB GA"},"entry_point":{"type":"string","example":"bin/tidb-server"},"name":{"type":"string","example":"tidb"},"os":{"type":"string","example":"linux"},"standalone":{"type":"boolean","example":false},"version":{"type":"string","example":"v7.5.0"}},"example":{"arch":"amd64","description":"TiDB GA","entry_point":"bin/tidb-server","name":"tidb","os":"linux","standalone":false,"version":"v7.5.0"},"required":["name","os","arch","version"]},"PublishRequestTiUP":{"type":"object","properties":{"from":{"$ref":"#/components/schemas/From"},"publish":{"$ref":"#/components/schemas/PublishInfoTiUP"}},"example":{"from":{"http":{"url":"https://example.com/tidb-v7.5.0-linux-amd64.tar.gz"},"type":"http"},"publish":{"arch":"amd64","description":"TiDB GA","entry_point":"bin/tidb-server","name":"tidb","os":"linux","standalone":false,"version":"v7.5.0"}},"required":["from","publish"]},"RequestMultiarchCollectRequestBody":{"type":"object","properties":{"async":{"type":"boolean","description":"Whether to run the collection asynchronously. If true, returns a request id. If false or omitted, runs synchronously and returns the result directly.","default":false,"example":true},"image_url":{"type":"string","description":"The image URL to collect","example":"Quia amet sed et quasi."},"release_tag_suffix":{"type":"string","description":"Suffix for the release tag","default":"release","example":"Aut pariatur quidem."}},"example":{"async":true,"image_url":"Laudantium officiis quis assumenda molestiae.","release_tag_suffix":"Assumenda labore voluptatem sunt."},"required":["image_url"]},"RequestMultiarchCollectResponseBody":{"type":"object","properties":{"async":{"type":"boolean","description":"Whether to run the collection asynchronously. If true, returns a request id. If false or omitted, runs synchronously and returns the result directly.","default":false,"example":true},"repo":{"type":"string","description":"Repository of the collected image","example":"Culpa dignissimos."},"request_id":{"type":"string","description":"Request id for async mode (uuidv4 format)","example":"0fb91531-a643-4b9e-aa91-0ca5e8d7c0dc","format":"uuid"},"tags":{"type":"array","items":{"type":"string","example":"Eligendi dignissimos et qui."},"description":"Tags of the collected image","example":["Ducimus maiores reiciendis voluptatem voluptas.","Nemo distinctio et labore.","Quis iure illo dolorum eos incidunt eius.","Id cupiditate vero."]}},"example":{"async":false,"repo":"Aut et nihil voluptas fuga.","request_id":"71fbb520-feff-4e57-b362-4747494c5f5b","tags":["Et blanditiis dolorem quasi.","Quisquam voluptatum velit aspernatur consequatur labore id."]},"required":["async"]},"RequestToCopyRequestBody":{"type":"object","properties":{"destination":{"type":"string","description":"destination image url","example":"Assumenda est sed nostrum laudantium aliquid."},"source":{"type":"string","description":"source image url","example":"Rerum recusandae esse perferendis."}},"example":{"destination":"Necessitatibus incidunt ratione.","source":"Exercitationem dolore distinctio provident quas."},"required":["source","destination"]},"RequestToPublishRequestBody":{"type":"object","properties":{"artifact_url":{"type":"string","description":"The full url of the pushed OCI artifact, contain the tag part. It will parse the repo from it.","example":"https://example.com/artifact.tar.gz"},"tiup-mirror":{"type":"string","description":"Staging is http://tiup.pingcap.net:8988, product is http://tiup.pingcap.net:8987.","default":"http://tiup.pingcap.net:8988","example":"Voluptatem ad voluptatum at."},"version":{"type":"string","description":"Force set the version. Default is the artifact version read from `org.opencontainers.image.version` of the manifest config.","example":"v1.0.0"}},"example":{"artifact_url":"https://example.com/artifact.tar.gz","tiup-mirror":"Consequuntur repellendus reiciendis.","version":"v1.0.0"},"required":["artifact_url","tiup-mirror"]},"RequestToPublishRequestBody2":{"type":"object","properties":{"artifact_url":{"type":"string","description":"The full url of the pushed OCI artifact, contain the tag part. It will parse the repo from it.","example":"Omnis architecto dignissimos sapiente voluptas voluptatem."}},"example":{"artifact_url":"Aut labore."},"required":["artifact_url"]}}},"tags":[{"name":"tiup","description":"TiUP Publisher service"},{"name":"fileserver","description":"Publisher service for static file server "},{"name":"image","description":"Publisher service for container image"}]}
