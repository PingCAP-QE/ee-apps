{"openapi":"3.0.3","info":{"title":"Publish API","description":"Publish API","contact":{"name":"WuHui Zuo","url":"https://github.com/wuhuizuo","email":"wuhui.zuo@pingcap.com"},"version":"1.0.0"},"servers":[{"url":"http://0.0.0.0:80"}],"paths":{"/fs/publish-request":{"post":{"tags":["fileserver"],"summary":"request-to-publish fileserver","operationId":"fileserver#request-to-publish","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/DeliveryByRulesRequestBody"},"example":{"artifact_url":"Esse nisi est."}}}},"responses":{"200":{"description":"OK response.","content":{"application/json":{"schema":{"type":"array","items":{"type":"string","description":"Request id for async mode (uuidv4 format)","example":"3757b3ec-7a6e-4712-8ecd-b263139d1a33","format":"uuid"},"description":"request track ids","example":["3c712ec2-b4cc-4a83-8feb-ed74ff2b3f81","b44102be-4d97-4d26-b1f6-20c866a829ce","dcf60a8b-478f-4f24-8a3a-d433be3fea02"]},"example":["5167a433-0a1d-4062-849d-e177cb317529","acb6a026-0934-4432-96d0-091e53f10ee5","16bcbce0-09bb-49f1-971d-1b7dec375d00","d6130f9e-59dc-4b2f-b39d-7169c5dac1ca"]}}}}}},"/fs/publish-request/{request_id}":{"get":{"tags":["fileserver"],"summary":"query-publishing-status fileserver","operationId":"fileserver#query-publishing-status","parameters":[{"name":"request_id","in":"path","description":"Request id for async mode (uuidv4 format)","required":true,"schema":{"type":"string","description":"Request id for async mode (uuidv4 format)","example":"3c2cf736-e77a-42c2-9a8c-e04cfe31840f","format":"uuid"},"example":"18660cd2-d66a-4a80-9cfb-e8aa76384685"}],"responses":{"200":{"description":"OK response.","content":{"application/json":{"schema":{"type":"string","description":"State of the task","example":"failed","enum":["queued","processing","success","failed","canceled"]},"example":"processing"}}}}}},"/image/collect-multiarch":{"post":{"tags":["image"],"summary":"request-multiarch-collect image","operationId":"image#request-multiarch-collect","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RequestMultiarchCollectRequestBody"},"example":{"async":false,"image_url":"Enim amet omnis unde quo.","release_tag_suffix":"Officia optio ut."}}}},"responses":{"200":{"description":"OK response.","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RequestMultiarchCollectResponseBody"},"example":{"async":false,"repo":"Repellendus quaerat.","request_id":"e2efeeb6-d9a5-4710-a923-5c356e41e89e","tags":["Ut cupiditate quia quas in eum.","Laboriosam adipisci sed in reiciendis vero.","Voluptatem culpa.","Et fuga rem cum voluptatum."]}}}}}}},"/image/collect-multiarch/{request_id}":{"get":{"tags":["image"],"summary":"query-multiarch-collect-status image","operationId":"image#query-multiarch-collect-status","parameters":[{"name":"request_id","in":"path","description":"Request id for async mode (uuidv4 format)","required":true,"schema":{"type":"string","description":"Request id for async mode (uuidv4 format)","example":"64368219-99d1-4588-8587-b3ed2f882e72","format":"uuid"},"example":"d4cfca85-0176-4931-9c97-00e0a2955efe"}],"responses":{"200":{"description":"OK response.","content":{"application/json":{"schema":{"type":"string","description":"State of the task","example":"failed","enum":["queued","processing","success","failed","canceled"]},"example":"processing"}}}}}},"/image/copy":{"post":{"tags":["image"],"summary":"request-to-copy image","operationId":"image#request-to-copy","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RequestToCopyRequestBody"},"example":{"destination":"Nam numquam et blanditiis.","source":"Nihil voluptas."}}}},"responses":{"200":{"description":"OK response.","content":{"application/json":{"schema":{"type":"string","description":"Request id for async mode (uuidv4 format)","example":"a783a90f-7316-46b6-bae1-65813456155b","format":"uuid"},"example":"51b29821-91cc-4cf1-ae98-89926a1d01c1"}}}}}},"/image/copy/{request_id}":{"get":{"tags":["image"],"summary":"query-copying-status image","operationId":"image#query-copying-status","parameters":[{"name":"request_id","in":"path","description":"Request id for async mode (uuidv4 format)","required":true,"schema":{"type":"string","description":"Request id for async mode (uuidv4 format)","example":"4a1b17ce-86ac-4c7c-9e54-03b15d2054c8","format":"uuid"},"example":"b120b540-cc19-497e-bc2b-bd69575e6b45"}],"responses":{"200":{"description":"OK response.","content":{"application/json":{"schema":{"type":"string","description":"State of the task","example":"processing","enum":["queued","processing","success","failed","canceled"]},"example":"queued"}}}}}},"/tiup/delivery-by-rules":{"post":{"tags":["tiup"],"summary":"delivery-by-rules tiup","description":"Request to delivery TiUP packages from OCI artifact controlled by delivery rules","operationId":"tiup#delivery-by-rules","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/DeliveryByRulesRequestBody"},"example":{"artifact_url":"oci.com/repo:tag"}}}},"responses":{"200":{"description":"OK response.","content":{"application/json":{"schema":{"type":"array","items":{"type":"string","example":"Odio eligendi est sapiente."},"description":"request track ids","example":["Exercitationem veniam non ut qui.","Dolorem numquam cumque.","Consequatur atque molestiae rem et placeat eos.","Tempora repellat sit eos neque optio."]},"example":["In veritatis.","Qui ut ut non autem."]}}}}}},"/tiup/publish-request":{"post":{"tags":["tiup"],"summary":"request-to-publish tiup","description":"Request to publish TiUP packages from a OCI artifact","operationId":"tiup#request-to-publish","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RequestToPublishRequestBody"},"example":{"artifact_url":"oci.com/repo:tag","tiup_mirror":"Fugit aut dolore recusandae distinctio suscipit.","version":"v1.0.0"}}}},"responses":{"200":{"description":"OK response.","content":{"application/json":{"schema":{"type":"array","items":{"type":"string","example":"Est labore autem aliquid qui."},"description":"request track ids","example":["Illum dolor.","Explicabo qui neque suscipit cumque.","Molestiae ea est nihil.","Sed rem dolore sed maxime est."]},"example":["Laboriosam magnam deserunt laudantium quia nam amet.","Enim optio earum necessitatibus voluptatem rem aut."]}}}}}},"/tiup/publish-request-single":{"post":{"tags":["tiup"],"summary":"request-to-publish-single tiup","description":"Request to publish a single TiUP package from a binary tarball","operationId":"tiup#request-to-publish-single","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PublishRequestTiUP"},"example":{"from":{"http":{"url":"https://example.com/tidb-v7.5.0-linux-amd64.tar.gz"},"type":"http"},"publish":{"arch":"amd64","description":"TiDB GA","entry_point":"bin/tidb-server","name":"tidb","os":"linux","standalone":false,"version":"v7.5.0"}}}}},"responses":{"200":{"description":"OK response.","content":{"application/json":{"schema":{"type":"string","description":"Request id for async mode (uuidv4 format)","example":"89eb1f69-9a72-418f-8427-44b6eb628fcb","format":"uuid"},"example":"7a3079ff-735f-4c00-9558-6834757c19a5"}}}}}},"/tiup/publish-request/{request_id}":{"get":{"tags":["tiup"],"summary":"query-publishing-status tiup","operationId":"tiup#query-publishing-status","parameters":[{"name":"request_id","in":"path","description":"request track id","required":true,"schema":{"type":"string","description":"request track id","example":"In exercitationem nam aut sit sequi."},"example":"Et provident commodi iusto enim repellendus."}],"responses":{"200":{"description":"OK response.","content":{"application/json":{"schema":{"type":"string","description":"State of the task","example":"success","enum":["queued","processing","success","failed","canceled"]},"example":"failed"}}}}}},"/tiup/reset-rate-limit":{"post":{"tags":["tiup"],"summary":"reset-rate-limit tiup","operationId":"tiup#reset-rate-limit","responses":{"200":{"description":"OK response."}}}}},"components":{"schemas":{"DeliveryByRulesRequestBody":{"type":"object","properties":{"artifact_url":{"type":"string","description":"The full url of the pushed OCI artifact, contain the tag part. It will parse the repo from it.","example":"oci.com/repo:tag"}},"example":{"artifact_url":"oci.com/repo:tag"},"required":["artifact_url"]},"From":{"type":"object","properties":{"http":{"$ref":"#/components/schemas/FromHTTP"},"oci":{"$ref":"#/components/schemas/FromOci"},"type":{"type":"string","example":"http","enum":["oci","http"]}},"example":{"http":{"url":"https://example.com/tidb-v7.5.0-linux-amd64.tar.gz"},"type":"http"},"required":["type"]},"FromHTTP":{"type":"object","properties":{"url":{"type":"string","example":"https://example.com/tidb-v7.5.0-linux-amd64.tar.gz"}},"description":"Source from a direct HTTP URL","example":{"url":"https://example.com/tidb-v7.5.0-linux-amd64.tar.gz"},"required":["url"]},"FromOci":{"type":"object","properties":{"file":{"type":"string","example":"tidb-v7.5.0-linux-amd64.tar.gz"},"repo":{"type":"string","example":"hub.pingcap.net/dev/ci/tidb"},"tag":{"type":"string","example":"v7.5.0_linux_amd64"}},"description":"Source from an OCI artifact","example":{"file":"tidb-v7.5.0-linux-amd64.tar.gz","repo":"hub.pingcap.net/dev/ci/tidb","tag":"v7.5.0_linux_amd64"},"required":["repo","tag","file"]},"PublishInfoTiUP":{"type":"object","properties":{"arch":{"type":"string","example":"amd64"},"description":{"type":"string","example":"TiDB GA"},"entry_point":{"type":"string","example":"bin/tidb-server"},"name":{"type":"string","example":"tidb"},"os":{"type":"string","example":"linux"},"standalone":{"type":"boolean","example":false},"version":{"type":"string","example":"v7.5.0"}},"example":{"arch":"amd64","description":"TiDB GA","entry_point":"bin/tidb-server","name":"tidb","os":"linux","standalone":false,"version":"v7.5.0"},"required":["name","os","arch","version"]},"PublishRequestTiUP":{"type":"object","properties":{"from":{"$ref":"#/components/schemas/From"},"publish":{"$ref":"#/components/schemas/PublishInfoTiUP"},"tiup_mirror":{"type":"string","description":"`staging` is http://tiup.pingcap.net:8988, `prod` is http://tiup.pingcap.net:8987.","default":"staging","example":"Debitis aut quisquam."}},"example":{"from":{"http":{"url":"https://example.com/tidb-v7.5.0-linux-amd64.tar.gz"},"type":"http"},"publish":{"arch":"amd64","description":"TiDB GA","entry_point":"bin/tidb-server","name":"tidb","os":"linux","standalone":false,"version":"v7.5.0"}},"required":["from","publish"]},"RequestMultiarchCollectRequestBody":{"type":"object","properties":{"async":{"type":"boolean","description":"Whether to run the collection asynchronously. If true, returns a request id. If false or omitted, runs synchronously and returns the result directly.","default":false,"example":false},"image_url":{"type":"string","description":"The image URL to collect","example":"Aliquam accusamus nobis et et consequatur suscipit."},"release_tag_suffix":{"type":"string","description":"Suffix for the release tag","default":"release","example":"Velit voluptas."}},"example":{"async":true,"image_url":"Laborum eum et possimus voluptas non.","release_tag_suffix":"Optio qui."},"required":["image_url"]},"RequestMultiarchCollectResponseBody":{"type":"object","properties":{"async":{"type":"boolean","description":"Whether to run the collection asynchronously. If true, returns a request id. If false or omitted, runs synchronously and returns the result directly.","default":false,"example":false},"repo":{"type":"string","description":"Repository of the collected image","example":"Voluptatem enim expedita qui."},"request_id":{"type":"string","description":"Request id for async mode (uuidv4 format)","example":"4b0a8de2-d409-4ec8-a593-1c430562adfc","format":"uuid"},"tags":{"type":"array","items":{"type":"string","example":"Beatae eos doloremque optio error vero iure."},"description":"Tags of the collected image","example":["Quaerat esse aut laborum.","Sit corporis sequi.","Quaerat doloremque explicabo."]}},"example":{"async":false,"repo":"In delectus a laboriosam.","request_id":"6dd65c85-76dc-4574-8d4b-03fb21562655","tags":["Deleniti voluptate reprehenderit deserunt.","Delectus expedita velit laudantium dolores et iusto."]},"required":["async"]},"RequestToCopyRequestBody":{"type":"object","properties":{"destination":{"type":"string","description":"destination image url","example":"Illo iure dolores adipisci cupiditate voluptatem."},"source":{"type":"string","description":"source image url","example":"Quasi qui."}},"example":{"destination":"Voluptas ea.","source":"Esse ut ab dolorem eos quas."},"required":["source","destination"]},"RequestToPublishRequestBody":{"type":"object","properties":{"artifact_url":{"type":"string","description":"The full url of the pushed OCI artifact, contain the tag part. It will parse the repo from it.","example":"oci.com/repo:tag"},"tiup_mirror":{"type":"string","description":"`staging` is http://tiup.pingcap.net:8988, `prod` is http://tiup.pingcap.net:8987.","default":"staging","example":"Possimus qui temporibus dolorem."},"version":{"type":"string","description":"Force set the version. Default is the artifact version read from `org.opencontainers.image.version` of the manifest config.","example":"v1.0.0"}},"example":{"artifact_url":"oci.com/repo:tag","tiup_mirror":"Impedit dicta.","version":"v1.0.0"},"required":["artifact_url"]},"TiupDeliveryResults":{"type":"object","properties":{"results":{"type":"object","example":{"prod":["8f2c62da-ba49-492a-84ad-6931c9dff6c6","c7c3acff-56f3-4e3c-8843-6e60d84edf18","7ffe1a4e-0aeb-423b-a61b-77219b042044","2f9b788f-d904-44ba-a06e-e8133598e62a"]},"additionalProperties":{"type":"array","items":{"type":"string","description":"Request id for async mode (uuidv4 format)","example":"8a5e7ea8-d930-4a74-a436-46b63c82d8f7","format":"uuid"},"example":["ed306989-6b2d-4add-8aab-2174a24f3a8e","3d63d34d-6b06-4f6a-b8ab-ab927fe909e5","f3410667-1ae5-46cf-9e8c-c8f0a066753d"]}}},"example":{"results":{"prod":["8df48081-9fd5-4f1d-8396-4a89c2ca4538","c8e1e940-4f67-4cfc-bca6-db16080a3c1a"]}}}}},"tags":[{"name":"tiup","description":"TiUP Publisher service"},{"name":"fileserver","description":"Publisher service for static file server "},{"name":"image","description":"Publisher service for container image"}]}